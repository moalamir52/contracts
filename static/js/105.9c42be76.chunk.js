(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e){var r=function(e,r){if("object"!=t(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,r||"default");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==t(r)?r:r+""}function r(t,r,o){return(r=e(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}importScripts("https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"),importScripts("https://unpkg.com/flexsearch@0.7.31/dist/flexsearch.compact.js");let n=null,a=[],c=new FlexSearch.Document({tokenize:"forward",document:{id:"contract",index:["contract","Customer Name","cars"]}});onmessage=function(t){console.log("Worker: Message received from main script");const{type:e,payload:s}=t.data;if("PROCESS_FILE"===e){const t=s;try{const e=new Uint8Array(t),s=XLSX.read(e,{type:"array"}),i=s.SheetNames[0],l=s.Sheets[i];c=new FlexSearch.Document({tokenize:"forward",document:{id:"contract",index:["contract","Customer Name","cars"]}});const u={},p={},f={},m=t=>(t||"").toString().replace(/\s+/g,"").toUpperCase(),d=XLSX.utils.decode_range(l["!ref"]);let g=0;const y=new Set;for(let t=d.s.r+1;t<=d.e.r;++t){g++;const e=e=>{const r=l[e+t];return r?"n"===r.t?r.v:XLSX.utils.format_cell(r):void 0},r=e("A"),o=e("B"),n=e("C"),a=e("D"),c=e("E"),s=e("F"),i=e("G"),d=e("H"),S=e("I"),h=e("J"),b=e("K");if(!r||!o||!n)continue;y.add(r);const O=m(o);u[r]||(u[r]={}),u[r][O]||(u[r][O]=[]),u[r][O].push(n),p[r]||(p[r]={"Pick-up Date":h||"","Drop-off Date":b||"","Plate Number":o||"","Car Model":c||"","Car Category":s||"","Manufacture Year":i||"","Customer Name":d||"","Customer Phone":S||""});const D=(t=>{if(t instanceof Date&&!isNaN(t)){const e=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear();return"".concat(e,"/").concat(r,"/").concat(o)}if("number"===typeof t){const e=Math.floor(t-25569),r=new Date(1e3*(86400*e)),o=Math.round(86400*(t-Math.floor(t))*1e3);r.setTime(r.getTime()+o);const n=String(r.getDate()).padStart(2,"0"),a=String(r.getMonth()+1).padStart(2,"0"),c=r.getFullYear();return"".concat(n,"/").concat(a,"/").concat(c)}if("string"===typeof t&&/^\d{4}-\d{2}-\d{2}/.test(t)){const e=new Date(t);if(!isNaN(e)){const t=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),o=e.getFullYear();return"".concat(t,"/").concat(r,"/").concat(o)}}return t})(n);f[O]||(f[O]={}),f[O][D]={model:c||"",category:s||"",year:i||"",pickupOdometer:a}}const S=[],h=[];Object.entries(u).forEach((t=>{let[e,n]=t,a=[];const s=t=>{if(t instanceof Date&&!isNaN(t)){const e=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear();return"".concat(e,"/").concat(r,"/").concat(o)}if("string"===typeof t&&/^\d{4}-\d{2}-\d{2}/.test(t)){const[e,r,o]=t.split("-"),[n]=o.split("T")[0].split(" ");return"".concat(n,"/").concat(r,"/").concat(e)}return t};Object.entries(n).forEach((t=>{let[e,r]=t;r.forEach((t=>{let r=t;if("number"===typeof t)r=(t=>{const e=Math.floor(t-25569),r=new Date(86400*e*1e3),o=Math.round(86400*(t-Math.floor(t))*1e3);return r.setTime(r.getTime()+o),r})(t);else if("string"===typeof t){const e=new Date(t);isNaN(e)||(r=e)}a.push({plate:e,date:r})}))})),a.sort(((t,e)=>new Date(t.date)-new Date(e.date)));let i=[],l=null,u=null,m=null,d=null;a.forEach(((t,e)=>{const{plate:r,date:o}=t;r!==l&&(null!==l&&i.push({plate:l,from:s(u),to:s(m),revenueDate:d}),u=o,d=t.date instanceof Date?t.date.toISOString():t.date),m=o,l=r,e===a.length-1&&i.push({plate:r,from:s(u),to:s(m),revenueDate:d})}));const g=i.map((t=>{let e=f[t.plate]&&f[t.plate][t.from]||{};if(!e.pickupOdometer){const r=f[t.plate];if(r){e=r[Object.keys(r)[0]]}}return"".concat(t.plate," | ").concat(e.model||"-"," | ").concat(e.category||"-"," | ").concat(e.year||"-"," | Pickup Odometer: ").concat(e.pickupOdometer||"-"," (").concat(t.from," - ").concat(t.to,")")})),y=Array.from(new Set(i.map((t=>t.plate)))),b=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({contract:e,cars:g,carsCount:y.length},p[e]);S.push(b),c.add(b),y.length>1&&h.push(b)}));const b={totalRows:g,uniqueContracts:y.size,multiCarContracts:h.length};n=S,a=h,postMessage({type:"FILE_PROCESSED",payload:{allContractsResultRows:S,multiCarResultRows:h,stats:b}})}catch(i){console.error("Worker error:",i),postMessage({type:"ERROR",payload:i.message})}}else if("INITIALIZE_DATA"===e)n=s.allUniqueContracts,a=s.results,postMessage({type:"SEARCH_RESULTS",payload:a});else if("SEARCH_DATA"===e){const{searchTerm:t}=s;if(!t.trim())return void postMessage({type:"SEARCH_RESULTS",payload:a});const e=t.trim(),r=c.search(e,{enrich:!0}),o=new Map;r.forEach((t=>{t.result.forEach((t=>{o.set(t.doc.contract,t.doc)}))}));const n=Array.from(o.values());postMessage({type:"SEARCH_RESULTS",payload:n})}}})();
//# sourceMappingURL=105.9c42be76.chunk.js.map