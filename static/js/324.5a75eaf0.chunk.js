"use strict";(self.webpackChunkcontracts=self.webpackChunkcontracts||[]).push([[324],{324:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var s=r(43),a=r(368),l=r(766),n=r.n(l),c=r(579);const o=e=>{let{onFileUpload:t,onBookingIdUpload:r,uploading:a}=e;const l=(0,s.useRef)(null),n=(0,s.useRef)(null);return(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"center",margin:"20px 0",gap:16,flexWrap:"wrap"},children:[(0,c.jsx)("button",{onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},disabled:a,style:{background:"#ffd600",color:"#6a1b9a",border:"none",borderRadius:8,padding:"10px 20px",fontWeight:"bold",cursor:"pointer",textDecoration:"none",fontSize:16,display:"inline-block",minWidth:180,textAlign:"center",marginBottom:0},children:"\u2b06\ufe0f Upload Multi-Car File"}),(0,c.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{e.target.files&&e.target.files[0]&&(t(e.target.files[0]),e.target.value="")},style:{display:"none"},ref:l}),(0,c.jsx)("button",{onClick:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.click()},style:{background:"#6a1b9a",color:"#ffd600",border:"none",borderRadius:8,padding:"10px 20px",fontWeight:"bold",cursor:"pointer",textDecoration:"none",fontSize:16,display:"inline-block",minWidth:180,textAlign:"center",marginBottom:0},children:"\ud83d\udcce Upload Invygo ID File"}),(0,c.jsx)("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:e=>{e.target.files&&e.target.files[0]&&(r(e.target.files[0]),e.target.value="")},style:{display:"none"},ref:n})]})},i=e=>{let{results:t,bookingIdMap:r,onSelectContract:a}=e;const[l,n]=s.useState(null);return 0===t.length?(0,c.jsx)("div",{className:"results-table-container",children:(0,c.jsxs)("table",{className:"results-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{className:"results-header",children:[(0,c.jsx)("th",{className:"header-cell",children:"#"}),(0,c.jsx)("th",{className:"header-cell",children:"Contract No."}),(0,c.jsx)("th",{className:"header-cell",children:"Booking ID"}),(0,c.jsx)("th",{className:"header-cell",children:"Customer"}),(0,c.jsx)("th",{className:"header-cell",children:"Cars (Plate & Dates)"}),(0,c.jsx)("th",{className:"header-cell",children:"Cars Count"})]})}),(0,c.jsx)("tbody",{children:(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:6,style:{textAlign:"center",padding:32,color:"#888",fontSize:18},children:"No data"})})})]})}):(0,c.jsx)("div",{className:"results-table-container",children:(0,c.jsxs)("table",{className:"results-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{className:"results-header",children:[(0,c.jsx)("th",{className:"header-cell",children:"#"}),(0,c.jsx)("th",{className:"header-cell",children:"Contract No."}),(0,c.jsx)("th",{className:"header-cell",children:"Booking ID"}),(0,c.jsx)("th",{className:"header-cell",style:{width:140},children:"Customer"}),(0,c.jsx)("th",{className:"header-cell",children:"Cars (Plate & Dates)"}),(0,c.jsx)("th",{className:"header-cell",children:"Cars Count"})]})}),(0,c.jsx)("tbody",{children:t.map((e,t)=>(0,c.jsxs)("tr",{style:{background:t%2===0?"#fffde7":"#fff",transition:"background 0.2s"},children:[(0,c.jsx)("td",{className:"data-cell",children:t+1}),(0,c.jsx)("td",{className:"data-cell",style:{minWidth:80,fontWeight:"bold"},children:(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[(0,c.jsx)("button",{className:"contract-btn",onClick:()=>a(e),title:"Show contract details",type:"button",children:e.contractNo||e.contract}),(0,c.jsx)("button",{className:"copy-btn ".concat(l===(e.contractNo||e.contract)?"bg-green":"bg-yellow"),onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e),n(e),setTimeout(()=>n(null),2e3)}catch(t){console.error("Failed to copy:",t)}})(e.contractNo||e.contract),title:"Copy contract number",type:"button",children:l===(e.contractNo||e.contract)?"\u2713":"\ud83d\udccb"})]})}),(0,c.jsx)("td",{className:"data-cell",children:r.get(e.contractNo||e.contract)||"Branch"}),(0,c.jsx)("td",{className:"data-cell",style:{maxWidth:100,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.customerName||e["Customer Name"]}),(0,c.jsx)("td",{className:"data-cell",style:{padding:0,background:"#fff"},children:(0,c.jsxs)("table",{className:"cars-table",children:[(0,c.jsxs)("colgroup",{children:[(0,c.jsx)("col",{style:{width:"25%"}}),(0,c.jsx)("col",{style:{width:"25%"}}),(0,c.jsx)("col",{style:{width:"25%"}}),(0,c.jsx)("col",{style:{width:"25%"}})]}),(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{style:{background:"linear-gradient(90deg,#e0f7fa 60%,#b2ebf2 100%)"},children:[(0,c.jsx)("th",{style:{border:"1px solid #26c6da",padding:"10px 8px",fontSize:15,color:"#006064",background:"#e0f7fa",fontWeight:700},children:"Model"}),(0,c.jsx)("th",{style:{border:"1px solid #26c6da",padding:"10px 8px",fontSize:15,color:"#006064",background:"#e0f7fa",fontWeight:700},children:"Plate"}),(0,c.jsx)("th",{style:{border:"1px solid #26c6da",padding:"10px 8px",fontSize:15,color:"#006064",background:"#e0f7fa",fontWeight:700},children:"From"}),(0,c.jsx)("th",{style:{border:"1px solid #26c6da",padding:"10px 8px",fontSize:15,color:"#006064",background:"#e0f7fa",fontWeight:700},children:"To"})]})}),(0,c.jsxs)("tbody",{children:[e.carDetails&&e.carDetails.map((e,t)=>(0,c.jsxs)("tr",{style:{background:t%2===0?"#ffffff":"#b2ebf2"},children:[(0,c.jsx)("td",{style:{border:"1px solid #26c6da",padding:"6px",color:"#00838f",fontWeight:600,fontSize:14},children:e.carModel}),(0,c.jsx)("td",{style:{border:"1px solid #26c6da",padding:"6px",color:"#00838f",fontWeight:700,fontSize:14},children:e.plateNumber}),(0,c.jsx)("td",{style:{border:"1px solid #26c6da",padding:"6px",color:"#00838f",fontWeight:600,fontSize:14},children:e.from}),(0,c.jsx)("td",{style:{border:"1px solid #26c6da",padding:"6px",color:"#00838f",fontWeight:600,fontSize:14},children:e.to})]},t)),!e.carDetails&&e.cars&&e.cars.map((e,t)=>(0,c.jsx)("tr",{children:(0,c.jsx)("td",{children:e})},t))]})]})}),(0,c.jsxs)("td",{className:"data-cell",style:{fontWeight:"bold",color:"#6a1b9a"},children:[e.carsCount," Cars"]})]},t))})]})})};var d=r(453);const u="multiCarData",h={open:()=>new Promise((e,t)=>{const r=indexedDB.open("ContractsDB",1);r.onerror=e=>t("Database error: "+e.target.error),r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(u)||t.createObjectStore(u)},r.onsuccess=t=>e(t.target.result)}),save:async(e,t)=>{const r=await h.open();return new Promise((s,a)=>{const l=r.transaction([u],"readwrite").objectStore(u).put(t,e);l.onsuccess=()=>s(!0),l.onerror=e=>a(e.target.error)})},get:async e=>{const t=await h.open();return new Promise((r,s)=>{const a=t.transaction([u],"readonly").objectStore(u).get(e);a.onsuccess=()=>r(a.result),a.onerror=e=>s(e.target.error)})},clear:async()=>{const e=await h.open();return new Promise((t,r)=>{const s=e.transaction([u],"readwrite").objectStore(u).clear();s.onsuccess=()=>t(!0),s.onerror=e=>r(e.target.error)})}};function x(){const e=(0,a.Zp)(),[t,l]=(0,s.useState)([]),[u,x]=(0,s.useState)(null),[p,m]=(0,s.useState)(new Map),[g,f]=(0,s.useState)(""),[j,b]=(0,s.useState)(""),[y,N]=(0,s.useState)(null),[C,k]=(0,s.useState)(!1),[S,v]=(0,s.useState)(""),w=s.useRef(null);(0,s.useEffect)(()=>{w.current=new Worker(new URL(r.p+r.u(829),r.b)),w.current.onmessage=e=>{const{success:t,results:r,summary:s,error:a,progress:n}=e.data;n?v(n):t?(l(r||[]),x(s),h.save("results",r).catch(e=>console.error("DB Save Error",e)),h.save("summary",s).catch(e=>console.error("DB Save Error",e)),k(!1),v("")):a&&(console.error("Worker error:",a),alert("Error processing file: "+a),k(!1),v(""))};return(async()=>{try{const e=await h.get("results");e&&l(e);const t=await h.get("summary");t&&x(t)}catch(e){console.error("Failed to load saved data",e)}})(),()=>{w.current&&w.current.terminate()}},[]);const D=(0,s.useMemo)(()=>{if(!g.trim())return t;const e=g.trim().toLowerCase(),r=(0,d.S)(e);return t.filter(t=>{const s=t.contractNo||t.contract;if(s&&(s.toLowerCase().includes(e)||(0,d.S)(s).includes(r)))return!0;const a=t.customerName||t["Customer Name"];if(a&&(a.toLowerCase().includes(e)||(0,d.S)(a).includes(r)))return!0;if(t.carsCount&&t.carsCount.toString()===e)return!0;const l=p.get(s)||"";return!(!l||!l.toLowerCase().includes(e)&&!(0,d.S)(l).includes(r))||!!t.carDetails&&t.carDetails.some(t=>t.plateNumber.toLowerCase().includes(e)||(0,d.S)(t.plateNumber).includes(r))})},[g,t,p]);return(0,c.jsxs)("div",{className:"multi-contract-page",children:[C&&(0,c.jsx)("div",{className:"processing-overlay",children:(0,c.jsxs)("div",{className:"processing-box",children:[(0,c.jsx)("div",{className:"spinner"}),(0,c.jsx)("span",{className:"processing-text",children:S||"Processing..."})]})}),(0,c.jsx)("button",{className:"back-button",onClick:()=>e("/"),children:"\u2190 Back"}),(0,c.jsx)("div",{className:"page-header",children:(0,c.jsx)("div",{className:"title-box",children:(0,c.jsx)("h2",{className:"page-title",children:"Multi-Car Contracts"})})}),(0,c.jsx)(o,{onFileUpload:e=>{e&&(k(!0),l([]),x(null),v("Reading file..."),w.current&&w.current.postMessage({type:"RESET"}),n().parse(e,{header:!0,worker:!0,skipEmptyLines:!0,chunk:e=>{let{data:t}=e;w.current&&w.current.postMessage({type:"CHUNK",data:t})},complete:()=>{w.current&&w.current.postMessage({type:"DONE"})},error:e=>{console.error("Papa Parse Error",e),alert("Error parsing CSV"),k(!1)}}))},onBookingIdUpload:e=>{e&&n().parse(e,{header:!0,skipEmptyLines:!0,complete:e=>{const t=new Map;e.data.forEach(e=>{const r=e.Agreement,s=e["Booking ID"];r&&s&&t.set(String(r),String(s))}),m(t)}})},uploading:C}),u&&(0,c.jsxs)("div",{className:"summary-box",children:[(0,c.jsx)("h3",{className:"summary-title",children:"File Upload Summary"}),(0,c.jsx)("table",{className:"summary-table",children:(0,c.jsxs)("tbody",{children:[(0,c.jsxs)("tr",{style:{background:"#fffde7"},children:[(0,c.jsx)("td",{className:"summary-label",children:"Total Rows"}),(0,c.jsx)("td",{className:"summary-value",children:u.totalRows})]}),(0,c.jsxs)("tr",{style:{background:"#fff"},children:[(0,c.jsx)("td",{className:"summary-label",children:"Total Contracts"}),(0,c.jsx)("td",{className:"summary-value",children:u.totalContracts})]}),(0,c.jsxs)("tr",{style:{background:"#fffde7"},children:[(0,c.jsx)("td",{className:"summary-label",children:"Single Car Contracts"}),(0,c.jsx)("td",{className:"summary-value",children:u.singleCarContracts})]}),(0,c.jsxs)("tr",{style:{background:"#fff"},children:[(0,c.jsx)("td",{className:"summary-label",children:"Multi-Car Contracts"}),(0,c.jsx)("td",{className:"summary-value",children:u.multiCarContracts})]})]})})]}),(0,c.jsxs)("div",{className:"search-container",children:[(0,c.jsx)("input",{className:"search-input",type:"text",value:j,onChange:e=>b(e.target.value),onKeyDown:e=>"Enter"===e.key&&f(j),placeholder:"Search contract, booking ID, plate, customer..."}),(0,c.jsx)("button",{className:"action-button",onClick:()=>f(j),children:"Search"}),(0,c.jsx)("button",{className:"action-button",onClick:()=>{f(""),b(""),l([]),x(null),h.clear().catch(console.error)},children:"Reset"})]}),(0,c.jsx)(i,{results:D,bookingIdMap:p,onSelectContract:N})]})}},453:(e,t,r)=>{r.d(t,{S:()=>s,h:()=>a});const s=e=>{if(!e)return"";let t=e.toLowerCase();t=t.replace(/\u0430/g,"a"),t=t.replace(/\u0441/g,"c"),t=t.replace(/\u0435/g,"e"),t=t.replace(/\u043e/g,"o"),t=t.replace(/\u0440/g,"p");const r=t.replace(/[^a-z0-9]/g,""),s=(r.match(/[a-z]/g)||[]).sort().join("");return(r.match(/[0-9]/g)||[]).join("")+s},a=e=>{if(!e)return"";let t=e.replace(/\D/g,"");return t.startsWith("05")&&10===t.length?"971".concat(t.substring(1)):(t.startsWith("971")&&t.length,t)}}}]);
//# sourceMappingURL=324.5a75eaf0.chunk.js.map